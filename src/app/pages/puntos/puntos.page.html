<ion-content fullscreen="true" class="onboard-content">
  <div class="viewport">

    <!-- Botón de audio centrado -->
    <div class="audio-wrap">
      <ion-button
        class="audio-btn"
        aria-label="Escuchar progreso"
        (click)="onMainAudio()"
      >
        <ion-icon name="volume-high-outline"></ion-icon>
      </ion-button>
    </div>

    <!-- Título -->
    <h2 class="big-title">¡Mira tu<br>progreso!</h2>

    <!-- Donut -->
    <div class="donut-wrap">
      <svg class="donut" [attr.viewBox]="'0 0 ' + (center*2) + ' ' + (center*2)">
        <defs>
          <!-- Halo suave -->
          <filter [attr.id]="glowId" x="-50%" y="-50%" width="200%" height="200%">
            <feGaussianBlur stdDeviation="3" result="blur"/>
            <feMerge>
              <feMergeNode in="blur"/>
              <feMergeNode in="SourceGraphic"/>
            </feMerge>
          </filter>
        </defs>

        <!-- Borde interior -->
        <circle
          class="inner-ring"
          [attr.cx]="center" [attr.cy]="center" [attr.r]="radius - stroke/2"
          stroke="#d9f0e4" stroke-width="1.5" fill="none">
        </circle>

        <!-- TRACK -->
        <circle
          class="track"
          [attr.cx]="center" [attr.cy]="center" [attr.r]="radius"
          [attr.stroke-width]="stroke"
          stroke="#e6f0ea"
          stroke-linecap="round" fill="none">
        </circle>

        <!-- GLOW del progreso -->
        <circle
          class="progress glow"
          [attr.cx]="center" [attr.cy]="center" [attr.r]="radius"
          [attr.stroke-width]="stroke"
          [attr.stroke-dasharray]="circumference"
          [attr.stroke-dashoffset]="dashOffset"
          [attr.stroke]="colorActual"
          stroke-linecap="round" fill="none"
          [attr.filter]="'url(#' + glowId + ')'">
        </circle>

        <!-- PROGRESO -->
        <circle
          class="progress"
          [attr.cx]="center" [attr.cy]="center" [attr.r]="radius"
          [attr.stroke-width]="stroke"
          [attr.stroke-dasharray]="circumference"
          [attr.stroke-dashoffset]="dashOffset"
          [attr.stroke]="colorActual"
          stroke-linecap="round" fill="none">
        </circle>

        <!-- Puntito final -->
        <circle class="cap-dot" [attr.cx]="endX" [attr.cy]="endY" r="4.2" [attr.fill]="colorActual"></circle>
        <circle class="cap-dot glow" [attr.cx]="endX" [attr.cy]="endY" r="7" [attr.fill]="colorActual" opacity=".25"></circle>
      </svg>

      <div class="donut-center">
        <div class="value">{{ shown | number:'1.0-0' }}%</div>
        <div class="sub">de responsabilidad</div>
      </div>
    </div>

    <!-- Barras por día -->
    <div class="bars">
      <div class="bar-col" *ngFor="let v of dayValues; let i = index">
        <div class="bar" [ngStyle]="{ height: (v + 'px'), background: dayColors[i] }"></div>
        <div class="lbl">{{ dayLabels[i] }}</div>
      </div>
    </div>

    <!-- Tarjeta de retroalimentación -->
    <div class="dashed-card">
      <h3 class="headline">{{ porcentajeHoy < 50 ? '¡Ups!' : '¡Increíble!' }}</h3>
      <p class="note">{{ feedbackMessage }}</p>

      <div class="dog">
        <ion-img *ngIf="!feedbackMedia.endsWith('.mp4')"
                 [src]="feedbackMedia"
                 alt="Estado de mascota"
                 class="dog-image">
        </ion-img>
      </div>
    </div>
  </div>

  <!-- Barra inferior -->
  <nav class="bottom-bar">
    <a class="tab" href="/home">
      <ion-icon name="home-outline"></ion-icon>
      <span>Inicio</span>
    </a>
    <a class="tab active" href="#">
      <ion-icon name="heart-outline"></ion-icon>
      <span>Puntos</span>
    </a>
    <a class="tab" href="perfil">
      <ion-icon name="person-outline"></ion-icon>
      <span>Perfil</span>
    </a>
  </nav>
</ion-content>
